# üìö Documentation API Laravel - Images Management

## üåê **Informations G√©n√©rales de l'API**

### üîó **Configuration Serveur**
- **URL de Base** : `http://127.0.0.1:8000`
- **Pr√©fixe API** : `/api/v1`
- **URL Compl√®te** : `http://127.0.0.1:8000/api/v1`
- **Authentification** : Aucune (API publique)
- **Format de R√©ponse** : JSON
- **Encodage** : UTF-8

### üöÄ **D√©marrage du Serveur**
```bash
# Dans le dossier du projet Laravel
cd C:\xampp\htdocs\orientanewversion

# D√©marrer le serveur de d√©veloppement
php artisan serve

# R√©sultat attendu:
# INFO  Server running on [http://127.0.0.1:8000].
```

### üìã **Pr√©requis**
- ‚úÖ **XAMPP MySQL** d√©marr√©
- ‚úÖ **PHP 8.1+** install√©
- ‚úÖ **Laravel 11** configur√©
- ‚úÖ **Base de donn√©es** : `orientasuccess`
- ‚úÖ **Table** : `images`

---

## üõ£Ô∏è **Routes Disponibles**

### üìä **Tableau des Endpoints**

| M√©thode | Endpoint | Description | Param√®tres |
|---------|----------|-------------|------------|
| `GET` | `/api/v1/images` | Liste toutes les images | - |
| `POST` | `/api/v1/images` | Upload une nouvelle image | `image` (file), `alt_text` (string, optionnel) |
| `GET` | `/api/v1/images/{id}` | D√©tails d'une image sp√©cifique | `id` (integer) |
| `PUT` | `/api/v1/images/{id}` | Mettre √† jour une image | `id` (integer), `alt_text` (string) |
| `DELETE` | `/api/v1/images/{id}` | Supprimer une image | `id` (integer) |
| `GET` | `/api/v1/images/{id}/url` | Obtenir l'URL publique d'une image | `id` (integer) |

### üè∑Ô∏è **Headers Requis**
```http
Accept: application/json
Content-Type: application/json  (pour GET/DELETE)
Content-Type: multipart/form-data  (pour POST avec fichier)
```

---

## üìã **D√©tails des Endpoints**

### 1. üì• **GET /api/v1/images** - Liste des Images

**Description** : R√©cup√®re la liste de toutes les images tri√©es par date de cr√©ation (plus r√©centes en premier)

**URL Compl√®te** : `http://127.0.0.1:8000/api/v1/images`

**M√©thode** : `GET`

**Param√®tres** : Aucun

**R√©ponse Succ√®s (200)** :
```json
{
  "success": true,
  "message": "Images r√©cup√©r√©es avec succ√®s",
  "data": [
    {
      "id": 1,
      "filename": "550e8400-e29b-41d4-a716-446655440000.jpg",
      "original_name": "mon_image.jpg",
      "path": "images/550e8400-e29b-41d4-a716-446655440000.jpg",
      "url": "http://127.0.0.1:8000/storage/images/550e8400-e29b-41d4-a716-446655440000.jpg",
      "mime_type": "image/jpeg",
      "size": 1048576,
      "formatted_size": "1.00 MB",
      "width": 1920,
      "height": 1080,
      "alt_text": "Description de l'image",
      "created_at": "2025-08-07T10:30:00.000000Z",
      "updated_at": "2025-08-07T10:30:00.000000Z"
    }
  ]
}
```

**R√©ponse Erreur (500)** :
```json
{
  "success": false,
  "message": "Erreur lors de la r√©cup√©ration des images",
  "error": "Message d'erreur d√©taill√©"
}
```

---

### 2. üì§ **POST /api/v1/images** - Upload d'Image

**Description** : Upload une nouvelle image sur le serveur

**URL Compl√®te** : `http://127.0.0.1:8000/api/v1/images`

**M√©thode** : `POST`

**Content-Type** : `multipart/form-data`

**Param√®tres** :
- `image` (file, **requis**) : Le fichier image √† uploader
- `alt_text` (string, optionnel) : Texte alternatif pour l'image

**Formats Support√©s** : JPG, JPEG, PNG, GIF, WEBP

**Taille Maximum** : D√©finie par PHP (g√©n√©ralement 2MB par d√©faut)

**Exemple de Requ√™te** :
```http
POST http://127.0.0.1:8000/api/v1/images
Content-Type: multipart/form-data

image: [fichier binaire]
alt_text: "Photo de l'universit√© XYZ"
```

**R√©ponse Succ√®s (201)** :
```json
{
  "success": true,
  "message": "Image upload√©e avec succ√®s",
  "data": {
    "id": 1,
    "filename": "550e8400-e29b-41d4-a716-446655440000.jpg",
    "original_name": "mon_image.jpg",
    "path": "images/550e8400-e29b-41d4-a716-446655440000.jpg",
    "url": "http://127.0.0.1:8000/storage/images/550e8400-e29b-41d4-a716-446655440000.jpg",
    "mime_type": "image/jpeg",
    "size": 1048576,
    "formatted_size": "1.00 MB",
    "width": 1920,
    "height": 1080,
    "alt_text": "Photo de l'universit√© XYZ",
    "created_at": "2025-08-07T10:30:00.000000Z",
    "updated_at": "2025-08-07T10:30:00.000000Z"
  }
}
```

**R√©ponse Erreur Validation (422)** :
```json
{
  "message": "The given data was invalid.",
  "errors": {
    "image": [
      "The image field is required."
    ]
  }
}
```

**R√©ponse Erreur Serveur (500)** :
```json
{
  "success": false,
  "message": "Erreur lors de l'upload de l'image",
  "error": "Message d'erreur d√©taill√©"
}
```

---

### 3. üîç **GET /api/v1/images/{id}** - D√©tails d'une Image

**Description** : R√©cup√®re les d√©tails d'une image sp√©cifique

**URL Compl√®te** : `http://127.0.0.1:8000/api/v1/images/{id}`

**M√©thode** : `GET`

**Param√®tres URL** :
- `id` (integer, **requis**) : L'ID de l'image

**Exemple** : `http://127.0.0.1:8000/api/v1/images/1`

**R√©ponse Succ√®s (200)** :
```json
{
  "success": true,
  "message": "Image r√©cup√©r√©e avec succ√®s",
  "data": {
    "id": 1,
    "filename": "550e8400-e29b-41d4-a716-446655440000.jpg",
    "original_name": "mon_image.jpg",
    "path": "images/550e8400-e29b-41d4-a716-446655440000.jpg",
    "url": "http://127.0.0.1:8000/storage/images/550e8400-e29b-41d4-a716-446655440000.jpg",
    "mime_type": "image/jpeg",
    "size": 1048576,
    "formatted_size": "1.00 MB",
    "width": 1920,
    "height": 1080,
    "alt_text": "Description de l'image",
    "created_at": "2025-08-07T10:30:00.000000Z",
    "updated_at": "2025-08-07T10:30:00.000000Z"
  }
}
```

**R√©ponse Erreur Non Trouv√© (404)** :
```json
{
  "success": false,
  "message": "Image non trouv√©e"
}
```

---

### 4. ‚úèÔ∏è **PUT /api/v1/images/{id}** - Modifier une Image

**Description** : Met √† jour le texte alternatif d'une image

**URL Compl√®te** : `http://127.0.0.1:8000/api/v1/images/{id}`

**M√©thode** : `PUT`

**Content-Type** : `application/json`

**Param√®tres URL** :
- `id` (integer, **requis**) : L'ID de l'image

**Param√®tres Body** :
- `alt_text` (string, **requis**) : Nouveau texte alternatif

**Exemple de Requ√™te** :
```http
PUT http://127.0.0.1:8000/api/v1/images/1
Content-Type: application/json

{
  "alt_text": "Nouveau texte alternatif"
}
```

**R√©ponse Succ√®s (200)** :
```json
{
  "success": true,
  "message": "Image mise √† jour avec succ√®s",
  "data": {
    "id": 1,
    "filename": "550e8400-e29b-41d4-a716-446655440000.jpg",
    "original_name": "mon_image.jpg",
    "path": "images/550e8400-e29b-41d4-a716-446655440000.jpg",
    "url": "http://127.0.0.1:8000/storage/images/550e8400-e29b-41d4-a716-446655440000.jpg",
    "mime_type": "image/jpeg",
    "size": 1048576,
    "formatted_size": "1.00 MB",
    "width": 1920,
    "height": 1080,
    "alt_text": "Nouveau texte alternatif",
    "created_at": "2025-08-07T10:30:00.000000Z",
    "updated_at": "2025-08-07T10:35:00.000000Z"
  }
}
```

**R√©ponse Erreur Non Trouv√© (404)** :
```json
{
  "success": false,
  "message": "Image non trouv√©e"
}
```

---

### 5. üóëÔ∏è **DELETE /api/v1/images/{id}** - Supprimer une Image

**Description** : Supprime une image et son fichier physique

**URL Compl√®te** : `http://127.0.0.1:8000/api/v1/images/{id}`

**M√©thode** : `DELETE`

**Param√®tres URL** :
- `id` (integer, **requis**) : L'ID de l'image

**Exemple** : `http://127.0.0.1:8000/api/v1/images/1`

**R√©ponse Succ√®s (200)** :
```json
{
  "success": true,
  "message": "Image supprim√©e avec succ√®s"
}
```

**R√©ponse Erreur Non Trouv√© (404)** :
```json
{
  "success": false,
  "message": "Image non trouv√©e"
}
```

**R√©ponse Erreur Serveur (500)** :
```json
{
  "success": false,
  "message": "Erreur lors de la suppression de l'image",
  "error": "Message d'erreur d√©taill√©"
}
```

---

### 6. üîó **GET /api/v1/images/{id}/url** - URL Publique d'une Image

**Description** : R√©cup√®re uniquement l'URL publique d'une image

**URL Compl√®te** : `http://127.0.0.1:8000/api/v1/images/{id}/url`

**M√©thode** : `GET`

**Param√®tres URL** :
- `id` (integer, **requis**) : L'ID de l'image

**Exemple** : `http://127.0.0.1:8000/api/v1/images/1/url`

**R√©ponse Succ√®s (200)** :
```json
{
  "success": true,
  "message": "URL de l'image r√©cup√©r√©e avec succ√®s",
  "data": {
    "id": 1,
    "url": "http://127.0.0.1:8000/storage/images/550e8400-e29b-41d4-a716-446655440000.jpg",
    "filename": "550e8400-e29b-41d4-a716-446655440000.jpg",
    "original_name": "mon_image.jpg"
  }
}
```

---

## üìä **Structure des Donn√©es**

### üñºÔ∏è **Objet Image Complet**
```json
{
  "id": 1,                    // ID unique de l'image
  "filename": "uuid.jpg",     // Nom de fichier g√©n√©r√© (UUID)
  "original_name": "img.jpg", // Nom original du fichier upload√©
  "path": "images/uuid.jpg",  // Chemin relatif du fichier
  "url": "http://127.0.0.1:8000/storage/images/uuid.jpg", // URL compl√®te
  "mime_type": "image/jpeg",  // Type MIME du fichier
  "size": 1048576,           // Taille en bytes
  "formatted_size": "1.00 MB", // Taille format√©e lisible
  "width": 1920,             // Largeur en pixels
  "height": 1080,            // Hauteur en pixels
  "alt_text": "Description", // Texte alternatif (peut √™tre null)
  "created_at": "2025-08-07T10:30:00.000000Z", // Date de cr√©ation
  "updated_at": "2025-08-07T10:30:00.000000Z"  // Date de modification
}
```

### üìù **Types de Donn√©es**
- `id`: integer
- `filename`: string (UUID + extension)
- `original_name`: string
- `path`: string
- `url`: string (URL compl√®te)
- `mime_type`: string
- `size`: integer (bytes)
- `formatted_size`: string (ex: "1.00 MB")
- `width`: integer (pixels)
- `height`: integer (pixels)
- `alt_text`: string|null
- `created_at`: datetime (ISO 8601)
- `updated_at`: datetime (ISO 8601)

---

## üö® **Gestion des Erreurs**

### üìã **Codes de Statut HTTP**
- `200` : Succ√®s
- `201` : Cr√©√© avec succ√®s
- `404` : Ressource non trouv√©e
- `422` : Erreur de validation
- `500` : Erreur serveur interne

### üîß **Format des Erreurs de Validation**
```json
{
  "message": "The given data was invalid.",
  "errors": {
    "field_name": [
      "Message d'erreur sp√©cifique"
    ]
  }
}
```

### ‚ö†Ô∏è **Format des Erreurs Serveur**
```json
{
  "success": false,
  "message": "Description de l'erreur",
  "error": "Message technique d√©taill√©"
}
```

---

## üîß **Configuration pour Flutter**

### üì± **URL selon l'Environnement**

**D√©veloppement Local (Localhost)** :
```dart
static const String baseUrl = 'http://127.0.0.1:8000/api/v1';
```

**√âmulateur Android** :
```dart
static const String baseUrl = 'http://10.0.2.2:8000/api/v1';
```

**Appareil Physique** :
```dart
// Remplacez par l'IP de votre PC
static const String baseUrl = 'http://192.168.1.XXX:8000/api/v1';
```

### üõ†Ô∏è **Service Flutter Recommand√©**
```dart
import 'dart:convert';
import 'dart:io';
import 'package:http/http.dart' as http;

class ImageApiService {
  static const String baseUrl = 'http://127.0.0.1:8000/api/v1';
  
  static Map<String, String> get headers => {
    'Accept': 'application/json',
    'Content-Type': 'application/json',
  };

  // GET /api/v1/images
  static Future<List<dynamic>> getAllImages() async {
    final response = await http.get(
      Uri.parse('$baseUrl/images'),
      headers: headers,
    );
    
    if (response.statusCode == 200) {
      final data = json.decode(response.body);
      return data['data'];
    }
    throw Exception('Erreur: ${response.statusCode}');
  }

  // POST /api/v1/images
  static Future<Map<String, dynamic>> uploadImage(File imageFile, {String? altText}) async {
    var request = http.MultipartRequest('POST', Uri.parse('$baseUrl/images'));
    
    request.files.add(await http.MultipartFile.fromPath('image', imageFile.path));
    if (altText != null) request.fields['alt_text'] = altText;
    
    var response = await request.send();
    var responseBody = await response.stream.bytesToString();
    
    if (response.statusCode == 201) {
      return json.decode(responseBody);
    }
    throw Exception('Erreur: ${response.statusCode}');
  }

  // GET /api/v1/images/{id}
  static Future<Map<String, dynamic>> getImage(int id) async {
    final response = await http.get(
      Uri.parse('$baseUrl/images/$id'),
      headers: headers,
    );
    
    if (response.statusCode == 200) {
      final data = json.decode(response.body);
      return data['data'];
    }
    throw Exception('Erreur: ${response.statusCode}');
  }

  // PUT /api/v1/images/{id}
  static Future<Map<String, dynamic>> updateImage(int id, String altText) async {
    final response = await http.put(
      Uri.parse('$baseUrl/images/$id'),
      headers: headers,
      body: json.encode({'alt_text': altText}),
    );
    
    if (response.statusCode == 200) {
      final data = json.decode(response.body);
      return data['data'];
    }
    throw Exception('Erreur: ${response.statusCode}');
  }

  // DELETE /api/v1/images/{id}
  static Future<bool> deleteImage(int id) async {
    final response = await http.delete(
      Uri.parse('$baseUrl/images/$id'),
      headers: headers,
    );
    
    return response.statusCode == 200;
  }

  // GET /api/v1/images/{id}/url
  static Future<String> getImageUrl(int id) async {
    final response = await http.get(
      Uri.parse('$baseUrl/images/$id/url'),
      headers: headers,
    );
    
    if (response.statusCode == 200) {
      final data = json.decode(response.body);
      return data['data']['url'];
    }
    throw Exception('Erreur: ${response.statusCode}');
  }
}
```

---

## üß™ **Tests de l'API**

### üìã **Checklist de Test**
- [ ] Serveur Laravel d√©marr√© : `php artisan serve`
- [ ] XAMPP MySQL actif
- [ ] Test GET /api/v1/images dans le navigateur
- [ ] Test upload avec Postman/curl
- [ ] V√©rification des fichiers dans storage/app/public/images

### üîß **Commandes de Test curl**

**Test de connexion** :
```bash
curl -X GET "http://127.0.0.1:8000/api/v1/images" -H "Accept: application/json"
```

**Test upload** :
```bash
curl -X POST "http://127.0.0.1:8000/api/v1/images" \
  -H "Accept: application/json" \
  -F "image=@/path/to/image.jpg" \
  -F "alt_text=Test image"
```

**Test r√©cup√©ration** :
```bash
curl -X GET "http://127.0.0.1:8000/api/v1/images/1" -H "Accept: application/json"
```

---

## üìÅ **Structure des Fichiers**

### üóÇÔ∏è **Dossiers Importants**
```
orientanewversion/
‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îú‚îÄ‚îÄ Http/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Controllers/Api/
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ImageController.php
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Requests/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ StoreImageRequest.php
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ UpdateImageRequest.php
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ Resources/
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ ImageResource.php
‚îÇ   ‚îî‚îÄ‚îÄ Models/
‚îÇ       ‚îî‚îÄ‚îÄ Image.php
‚îú‚îÄ‚îÄ routes/
‚îÇ   ‚îî‚îÄ‚îÄ api.php
‚îú‚îÄ‚îÄ storage/
‚îÇ   ‚îî‚îÄ‚îÄ app/
‚îÇ       ‚îî‚îÄ‚îÄ public/
‚îÇ           ‚îî‚îÄ‚îÄ images/  (fichiers upload√©s)
‚îî‚îÄ‚îÄ public/
    ‚îî‚îÄ‚îÄ storage/  (lien symbolique)
```

### üìù **Base de Donn√©es**
**Table** : `images`
```sql
CREATE TABLE images (
    id bigint PRIMARY KEY AUTO_INCREMENT,
    filename varchar(255) NOT NULL,
    original_name varchar(255) NOT NULL,
    path varchar(255) NOT NULL,
    mime_type varchar(255) NOT NULL,
    size bigint NOT NULL,
    width int,
    height int,
    alt_text text,
    created_at timestamp,
    updated_at timestamp
);
```

---

## üéØ **R√©sum√© pour l'√âquipe Flutter**

### ‚úÖ **Informations Essentielles**
- **URL Base** : `http://127.0.0.1:8000/api/v1`
- **Format** : JSON avec structure `{success, message, data}`
- **Upload** : Multipart form-data sur `/images`
- **CRUD Complet** : Toutes les op√©rations disponibles
- **Pas d'authentification** requise

### üöÄ **Pr√™t √† l'Int√©gration**
L'API est compl√®tement fonctionnelle et pr√™te pour l'int√©gration Flutter. Toutes les routes retournent des donn√©es coh√©rentes et g√®rent les erreurs proprement.

**L'√©quipe Flutter peut commencer l'int√©gration imm√©diatement !** üéâ
